{% extends 'base.html' %}
{% load static %}
{% block title %}
  이메일 인증을 완료하세요!
{% endblock title %}

{% block extrahead %}
  <link rel="stylesheet" type="text/css" href="{% static "css/user/email_sent.css"%}">
{% endblock extrahead %}


{% block content%}
  <div id="email_validation">
    <p class="signin-complete">이메일을 인증하면<br>회원가입 완료!</p>
    <div class="welcome-box">
      <img src="{% static "images/welcome-box.png" %}" alt="welcome-img">
    </div>
    <p class="info-message">지금 메일함에 도착한 링크에 접속해<br>회원가입을 완료해 주세요</p>
    <div class="user-button" id="send_email">인증 메일 보내기</div>
    <div class="user-button" id="complete_verification">인증 완료</div>
    <form id="myForm" method="POST">
      {% csrf_token %}
      <input type="submit" name="send_email" value="Send Email">
      <input type="submit" name="complete_verification" value="Complete Verification">
    </form>
    <div id="alert">
      <div class="popup">
        <div class="close-button"><img src="{% static "icons/close.png"%}" alt="x"></div>
        <img src="{% static "icons/alert.png"%}" alt="alert">
        <span>이메일 인증을 완료해주세요</span>
      </div>
    </div>
  </div>


{% endblock %}

{% block scripts %}
  <script>
    const sendEmailButton = document.getElementById("send_email");
    const completeVerificationButton = document.getElementById("complete_verification");
    const form = document.getElementById("myForm");

    sendEmailButton.addEventListener("click", () => {
      form.submit();
    });

    fetch('', {
      method: 'POST',
      headers: {
        'X-CSRFToken': '{{ csrf_token }}',
      },
      body: new FormData(form)
    })
    .then(response => response.json())
    .then(data => {
      if (data.message) {
        console.log(data.message);
        sendEmailButton.style.backgroundColor = '#fff';
        sendEmailButton.style.border = '#71aff';
        sendEmailButton.style.border = '2px solid #71a1ff';

        completeVerificationButton.style.cursor = 'pointer';
        completeVerificationButton.style.backgroundColor = '#71a1ff';
        completeVerificationButton.classList.add('active');

        completeVerificationButton.addEventListener("click", () => {
          form.submit();
        });
      } else if (data.error) {
        console.log(data.error);
        const popupAlert = document.getElementById('alert');
        popupAlert.style.display = 'block';
      }
    })
    .catch(error => {
      console.error(error);
    });

      
  </script>
{% endblock %}